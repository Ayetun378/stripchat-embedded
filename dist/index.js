!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.StripchatEmbedded={})}(this,function(t){"use strict";function e(t){if(""===t.src||t.queueIndex<this.loader.lastDrawnIndex)console.info("Stripchat Player :: Skip of successfully loaded image");else if(this.canvasRef&&(this.loader.lastDrawnIndex=t.queueIndex,!1!==this.successHandler(t))){var e=this.canvasRef.getContext("2d");if(this.canvasRef.width>0&&this.canvasRef.height>0&&t){var i=function(t,e){var i=t.height,n=t.width;if(!e)return{canvasWidth:n,canvasHeight:i,canvasWidthOffset:0,canvasHeightOffset:0};var s=e.height,r=e.width,a=Math.max(r/n,s/i),o=(n*a-r)/a,h=(i*a-s)/a;return{canvasWidth:n-o,canvasHeight:i-h,canvasWidthOffset:o/2,canvasHeightOffset:h/2}}(t,this.containerSize);this.canvasRef.width=this.containerSize.width,this.canvasRef.height=this.containerSize.height,e.clearRect(0,0,this.containerSize.width,this.containerSize.height),e.drawImage(t,i.canvasWidthOffset,i.canvasHeightOffset,i.canvasWidth,i.canvasHeight,0,0,this.canvasRef.width,this.canvasRef.height)}}}function i(){var t=new Image;return t.setAttribute("crossOrigin","anonymous"),t.onLoadListener=e.bind(this,t),t.onErrorListener=function(t){this.loader.queue&&(console.warn("Stripchat Player :: Image loading error"),this.unmount(),this.errorHandler(t))}.bind(this,t),t.addEventListener("load",t.onLoadListener),t.addEventListener("error",t.onErrorListener),t}function n(){if(this.loader.queue){var t=this.loader.queue.shift();t.src=("http:"===location.protocol?"http":"https")+"://c-"+this.snapshotServer+".stripcdn.com/snapshot/"+this.modelId+"?token="+this.modelToken+"&_="+(new Date).valueOf(),t.queueIndex=this.loader.lastQueuedIndex,this.loader.lastQueuedIndex+=1,this.loader.queue.push(t)}}function s(){this.canvasRef=null,this.fps=10,this.modelId="",this.modelToken="",this.snapshotServer="",this.successHandler=function(){},this.errorHandler=function(){},this.queueSize=30,this.loader={},this.paused=!1}s.prototype.setCanvasRef=function(t){if(!(t instanceof HTMLCanvasElement))throw Error("Stripchat Player :: setCanvasRef accepts only canvas elements");return this.canvasRef=t,this},s.prototype.setModelId=function(t){return this.modelId=""+t,this},s.prototype.setModelToken=function(t){return this.modelToken=""+t,this},s.prototype.setModelSnapshotServer=function(t){return this.snapshotServer=""+t,this},s.prototype.setFps=function(t){return this.fps=+t,this},s.prototype.setSuccessHandler=function(t){if(!(t instanceof Function))throw Error("Stripchat Player :: setSuccessHandler accepts only functions");return this.successHandler=t,this},s.prototype.setErrorHandler=function(t){if(!(t instanceof Function))throw Error("Stripchat Player :: setErrorHandler accepts only functions");return this.errorHandler=t,this},s.prototype.initLoader=function(){return this.loader={queue:[],interval:null,intervalTime:10*Math.round(100/this.fps),lastQueuedIndex:0,lastDrawnIndex:0},this},s.prototype.initQueue=function(){for(var t=[],e=0;this.queueSize>e;e++)t.push(i.call(this));return this.loader.queue=t,this},s.prototype.initInterval=function(){return this.loader.intervalTimer=function(){this.paused||n.call(this),this.loader.interval=setTimeout(this.loader.intervalTimer,this.loader.intervalTime)}.bind(this),this},s.prototype.init=function(){return this.containerSize={height:this.canvasRef.offsetHeight,width:this.canvasRef.offsetWidth},this.initLoader().initQueue().initInterval()},s.prototype.mount=function(){if(!this.canvasRef)throw Error("Stripchat Player :: canvas element was not specified");return this.init(),this.loader.intervalTimer(),this},s.prototype.unmount=function(){return this.loader.queue&&(this.loader.queue.forEach(function(t,e,i){i[e].src="",i[e].removeEventListener("load",i[e].onLoadListener)}),null!==this.loader.interval&&(clearTimeout(this.loader.interval),this.loader={})),this.loader={},this},s.prototype.pause=function(){return this.paused=!0,this},s.prototype.play=function(){this.paused=!1};var r={StripchatPlayer:s},a=r.StripchatPlayer;t.default=r,t.StripchatPlayer=a,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
